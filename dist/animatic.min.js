"use strict";function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(r,!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}var Animatic=function(){var l=Object.freeze({RUNNING:Symbol("RUNNING"),PAUSED:Symbol("PAUSED"),COMPLETED:Symbol("COMPLETED")}),e=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"forward",value:function(){throw Error("Not implemented!")}},{key:"pause",value:function(){throw Error("Not implemented!")}},{key:"backward",value:function(){throw Error("Not implemented!")}},{key:"adaptee",get:function(){throw Error("Not implemented!")}}]),t}(),r=function(){function e(t){_classCallCheck(this,e),this._handler=t.handler||null,this._backwardFunction=t.backward||null,this._pauseFunction=t.pause||null,this._resetFunction=t.reset||null,this._isFunctionHandler=t.handler instanceof Function,this._id=e._getNewId(),this._orchestra=null,this._animationStatus=l.PAUSED,this._previousNodes=new Map,this._previousCountdown=0,this._nextNodes=new Map,this._nextCountdown=0}return _createClass(e,null,[{key:"_getNewId",value:function(){return this._idCounter++}}]),_createClass(e,[{key:"to",value:function(t){if(null===this.orchestra)throw Error("Can't append to a stray node! Add it as an orchestra root first!");if(this.orchestra.animationStarted)throw Error("Can't add new animatic nodes once the orchestration started!");return t.orchestra=this.orchestra,this.orchestra._nodes.set(t.id,t),this._nextNodes.set(t.id,t),t._previousNodes.set(this.id,this),t._previousCountdown++,t}},{key:"split",value:function(t){var e;if(null!==this.orchestra){for(var r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];(e=this.orchestra).split.apply(e,[this,t].concat(n))}}},{key:"unite",value:function(t){var e;if(null!==this.orchestra){for(var r=arguments.length,n=new Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return(e=this.orchestra).split.apply(e,[this,t].concat(n)),this}}},{key:"forward",value:function(){this._animationStatus=l.RUNNING;var a=this;function t(){a._animationStatus=l.COMPLETED,0!=a.nextCount?a.orchestra.disableNode(a.id):a.orchestra.touchEnd(),a._nextCountdown=a.nextCount;var t=!0,e=!1,r=void 0;try{for(var n,i=a._nextNodes[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=_slicedToArray(n.value,2);o[0];o[1].forward()}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}this._previousCountdown--,0<this._previousCountdown||(this._previousCountdown=0,this.orchestra.activateNode(this.id),this._isFunctionHandler?(null===this._handler&&t(),this._handler(t)):this._handler.forward(t))}},{key:"pause",value:function(){null!==this._pauseFunction&&(this._animationStatus=l.PAUSED,this._isFunctionHandler?this._pauseFunction():this._handler.pause())}},{key:"backward",value:function(){this._animationStatus=l.RUNNING;var a=this;function t(){a._animationStatus=l.COMPLETED,0!=a.previousCount?a.orchestra.disableNode(a.id):a.orchestra.touchStart(),a._previousCountdown=a.previousCount;var t=!0,e=!1,r=void 0;try{for(var n,i=a._previousNodes[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=_slicedToArray(n.value,2);o[0];o[1].backward()}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}this._nextCountdown--,0<this._nextCountdown||(this._nextCountdown=0,this.orchestra.activateNode(this.id),this._isFunctionHandler?(null===this._backwardFunction&&t(),this._backwardFunction(t)):this._handler.backward(t))}},{key:"reset",value:function(){null!==this._resetFunction&&(this._animationStatus=l.PAUSED,this._isFunctionHandler?this._resetFunction():this._handler.reset())}},{key:"id",get:function(){return this._id}},{key:"orchestra",get:function(){return this._orchestra},set:function(t){if(null!==this._orchestra&&this._orchestra!=t)throw Error("AnimaticNode with id ".concat(this.id," already belongs to an orchestra!"));this._orchestra=t}},{key:"previousCount",get:function(){return this._previousNodes.size}},{key:"previousCountdown",get:function(){return this._previousCountdown}},{key:"nextCount",get:function(){return this._nextNodes.size}},{key:"nextCountdown",get:function(){return this._nextCountdown}},{key:"status",get:function(){return this._animationStatus}}]),e}();_defineProperty(r,"_idCounter",0);var n=function(){function t(){_classCallCheck(this,t),this._rootNodes=new Map,this._nodes=new Map,this._activeNodes=new Map,this._isAnimationStarted=!1,this._onBeginCallbacks=new Array,this._onCompleteCallbacks=new Array,this._animationStatus=l.PAUSED}return _createClass(t,[{key:"add",value:function(t){if(this._isAnimationStarted)throw Error("Can't add new animatic nodes once the orchestration started!");return this._rootNodes.set(t.id,t),this._activeNodes.set(t.id,t),this._nodes.set(t.id,t),t.orchestra=this,t}},{key:"_splitList",value:function(t,e){var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;t.to(s)}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"split",value:function(t,e){if(!this._nodes.has(t.id))throw Error("".concat(t," is not part of the orchestra!"));if(e instanceof Array){var r=e;this._splitList(t,r)}else{t.to(e);for(var n=arguments.length,i=new Array(2<n?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];this._splitList(t,i)}}},{key:"_uniteList",value:function(t,e){var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){o.value.to(t)}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"unite",value:function(t,e){if(e instanceof Array){var r=e;this._uniteList(t,r)}else{e.to(t);for(var n=arguments.length,i=new Array(2<n?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];this._uniteList(t,i)}return t}},{key:"play",value:function(){this._animationStatus=l.RUNNING;var t=!0,e=!1,r=void 0;try{for(var n,i=this._rootNodes[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=_slicedToArray(n.value,2);o[0];o[1].forward()}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}},{key:"pause",value:function(){this._animationStatus=l.PAUSED;var t=!0,e=!1,r=void 0;try{for(var n,i=new Map(this._activeNodes)[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=_slicedToArray(n.value,2);o[0];o[1].pause()}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}},{key:"reset",value:function(){this._animationStatus=l.PAUSED;var t=!0,e=!1,r=void 0;try{for(var n,i=this._nodes[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=_slicedToArray(n.value,2);o[0];o[1].reset()}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}this._activeNodes=_objectSpread({},this._rootNodes)}},{key:"reverse",value:function(){this._animationStatus=l.RUNNING;var t=!0,e=!1,r=void 0;try{for(var n,i=new Map(this._activeNodes)[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=_slicedToArray(n.value,2);o[0];o[1].backward()}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}},{key:"onBegin",value:function(t){this._onBeginCallbacks.push(t)}},{key:"onComplete",value:function(t){this._onCompleteCallbacks.push(t)}},{key:"_callBegan",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=this._onBeginCallbacks[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){(0,n.value)()}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}},{key:"_callCompleted",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=this._onCompleteCallbacks[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){(0,n.value)()}}catch(t){e=!0,r=t}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}}},{key:"activateNode",value:function(t){this._activeNodes.set(t,this._nodes.get(t))}},{key:"disableNode",value:function(t){this._activeNodes.delete(t)}},{key:"touchStart",value:function(){var t=0,e=!1,r=!0,n=!1,i=void 0;try{for(var o,a=this._activeNodes[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=_slicedToArray(o.value,2),u=(s[0],s[1]);t+=u.previousCount,e=e||u.status!=l.COMPLETED}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}0!=t||e||(this._animationStatus=l.COMPLETED,this._callCompleted())}},{key:"touchEnd",value:function(){var t=0,e=!1,r=!0,n=!1,i=void 0;try{for(var o,a=this._activeNodes[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=_slicedToArray(o.value,2),u=(s[0],s[1]);t+=u.nextCount,e=e||u.status!=l.COMPLETED}}catch(t){n=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}0!=t||e||(this._animationStatus=l.COMPLETED,this._callCompleted())}},{key:"rootNodes",get:function(){return this._rootNodes}},{key:"allNodes",get:function(){return this._nodes}},{key:"activeNodes",get:function(){return this._activeNodes}},{key:"animationStarted",get:function(){return this._isAnimationStarted}},{key:"finished",get:function(){return new Promise(function(t,e){})}},{key:"status",get:function(){return this._animationStatus}}]),t}();return new(function(){function t(){_classCallCheck(this,t),_defineProperty(this,"AnimationStatus",l),_defineProperty(this,"AbstractAnimaticAdapterNode",e),_defineProperty(this,"AnimaticNode",r),_defineProperty(this,"AnimaticOrchestra",n)}return _createClass(t,[{key:"orchestra",value:function(){return new n}},{key:"node",value:function(t){return new r(t)}}]),t}())}();